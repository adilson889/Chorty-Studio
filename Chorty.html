<!-- 
IMPORTANTE: SALVE ESTE ARQUIVO COM A EXTENS√ÉO .html 
Exemplo: chorty.html
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chorty Studio Ultimate</title>
    
    <!-- CDNs: Bibliotecas carregadas da internet -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Import Map para o Google GenAI -->
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.run/@google/genai"
      }
    }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; background-color: #0f172a; touch-action: manipulation; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        textarea:focus, input:focus { outline: none; }
        
        #loading-screen { position: fixed; inset: 0; background: #0f172a; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 9999; }
    </style>
</head>
<body>
    <div id="root">
        <div id="loading-screen">
            <div style="width: 50px; height: 50px; border: 4px solid #3b82f6; border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;"></div>
            <h2 style="font-weight: bold; font-size: 1.2rem;">Carregando Chorty...</h2>
            <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 10px;">Necess√°rio internet na primeira execu√ß√£o.</p>
        </div>
    </div>
    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <!-- Script Principal (Babel permite JSX no navegador) -->
    <script type="text/babel" data-type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- CONFIGURA√á√ïES GLOBAIS ---
        // EDITE AQUI SEU N√öMERO E SUA CHAVE MESTRA
        const CONFIG = {
            WHATSAPP_NUMBER: "5511999999999", // Coloque seu n√∫mero aqui (com DDI e DDD)
            MASTER_KEY: "CHORTY_PRO_2024", // A chave que o usu√°rio deve digitar para entrar
            DEFAULT_API_KEY: "" // Se quiser deixar sua chave Gemini fixa (cuidado ao compartilhar)
        };

        // Polyfill simples para process.env
        window.process = { env: { API_KEY: localStorage.getItem('GEMINI_API_KEY') || CONFIG.DEFAULT_API_KEY } };

        const { useState, useEffect, useRef } = React;

        // --- 1. SERVI√áOS (TRANSPILADOR & IA) ---

        // Dicion√°rios CSS
        const CSS_MAP = {'exibicao':'display','posicao':'position','largura':'width','altura':'height','margem':'margin','preenchimento':'padding','cor de fundo':'background-color','cor do texto':'color','flexivel':'flex','direcao':'flex-direction','alinhar itens':'align-items','justificar conteudo':'justify-content','grade':'grid','colunas da grade':'grid-template-columns','tamanho da fonte':'font-size','borda':'border','raio da borda':'border-radius','gap':'gap','topo':'top','esquerda':'left','direita':'right','baixo':'bottom'};
        const CSS_VALS = {'flexivel':'flex','grade':'grid','coluna':'column','linha':'row','centro':'center','absoluta':'absolute','relativa':'relative','fixa':'fixed','negrito':'bold','oculto':'none','azul':'#3b82f6','vermelho':'#ef4444','verde':'#22c55e','branco':'#fff','preto':'#000'};
        
        // Script injetado no preview (Terminal)
        const TERMINAL_SCRIPT = `(function(){var t=document.createElement('div');t.style.cssText='position:fixed;bottom:0;left:0;width:100%;background:#1a1b26;color:#a9b1d6;font-family:monospace;z-index:9999;max-height:30vh;display:flex;flex-direction:column;border-top:1px solid #333;font-size:12px;';var h=document.createElement('div');h.innerHTML='<span style="color:#7aa2f7">‚ùØ_</span> Terminal <span style="float:right;cursor:pointer" onclick="this.parentElement.parentElement.remove()">‚úñ</span>';h.style.cssText='background:#16161e;padding:5px;border-bottom:1px solid #333;font-weight:bold;';var c=document.createElement('div');c.style.cssText='overflow-y:auto;flex-grow:1;padding:5px;display:flex;flex-direction:column;';t.appendChild(h);t.appendChild(c);document.body.appendChild(t);function log(y,m){var d=document.createElement('div');d.style.borderBottom='1px solid #333';d.style.padding='2px 0';d.style.color=y==='e'?'#f7768e':(y==='w'?'#e0af68':'#73daca');d.textContent=(y==='e'?'‚úñ ':y==='w'?'‚ö† ':'‚ûú ')+m;c.appendChild(d);c.scrollTop=c.scrollHeight;}var o=console.log;console.log=function(){var a=Array.from(arguments).map(x=>typeof x==='object'?JSON.stringify(x):String(x)).join(' ');log('l',a);o.apply(console,arguments)};window.onerror=function(m){log('e',m)}})();`;

        const transpile = (code) => {
            const lines = code.split('\n');
            let html='',css='',js='',mode='html',defCss="body{margin:0;font-family:sans-serif;min-height:100vh;}*{box-sizing:border-box;}button{cursor:pointer;}";
            lines.forEach(line => {
                const t = line.trim();
                if(!t || t.startsWith('#')) return;
                if(t.startsWith('criar estilo')) { mode='css'; css+=t.includes('corpo')?'body{':'div{'; return; }
                if(t.startsWith('fechar estilo')) { mode='html'; css+='}'; return; }
                if(t.startsWith('criar comportamento')) { mode='js'; return; }
                if(t.startsWith('fechar comportamento')) { mode='html'; return; }
                if(mode==='html') {
                    if(t.startsWith('criar cabecalho')) html+='<header style="padding:1rem;background:#f8fafc;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #e2e8f0;">';
                    else if(t.startsWith('fechar cabecal')) html+='</header>';
                    else if(t.startsWith('criar corpo')) html+='<main style="padding:1.5rem;max-width:800px;margin:0 auto;">';
                    else if(t.startsWith('fechar corpo')) html+='</main>';
                    else if(t.startsWith('criar rodape')) html+='<footer style="padding:1rem;text-align:center;background:#f1f5f9;margin-top:auto;border-top:1px solid #e2e8f0;">';
                    else if(t.startsWith('fechar rodape')) html+='</footer>';
                    else if(t.startsWith('adicionar titulo')) html+=`<h1 style="font-size:2rem;font-weight:bold;margin-bottom:0.5em;">${t.match(/"([^"]+)"/)?.[1]||''}</h1>`;
                    else if(t.startsWith('adicionar subtitulo')) html+=`<h2 style="font-size:1.5rem;font-weight:600;margin-bottom:0.5em;">${t.match(/"([^"]+)"/)?.[1]||''}</h2>`;
                    else if(t.startsWith('adicionar paragrafo')) html+=`<p style="margin-bottom:1em;line-height:1.6;">${t.match(/"([^"]+)"/)?.[1]||''}</p>`;
                    else if(t.startsWith('adicionar botao')) { const txt=t.match(/"([^"]+)"/)?.[1]||'Btn'; const id=t.match(/com id "([^"]+)"/)?.[1]||''; html+=`<button id="${id}" style="padding:12px 24px;background:#3b82f6;color:white;border:none;border-radius:8px;font-weight:600;">${txt}</button>`; }
                    else if(t.startsWith('adicionar campo')) { const l=t.match(/"([^"]+)"/)?.[1]||'Lbl'; const id=t.match(/com id "([^"]+)"/)?.[1]||''; html+=`<div style="margin-bottom:10px"><label style="display:block;margin-bottom:5px;font-weight:500">${l}</label><input id="${id}" style="width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:6px;"></div>`; }
                    else if(t.startsWith('adicionar imagem')) { const src=t.match(/"([^"]+)"/)?.[1]||''; const id=t.match(/com id "([^"]+)"/)?.[1]||''; html+=`<img id="${id}" src="${src}" style="max-width:100%;border-radius:8px;margin:10px 0;">`; }
                }
                if(mode==='css') { const p=t.split(':'); if(p.length===2) css+=`${CSS_MAP[p[0].trim()]||p[0].trim()}:${CSS_VALS[p[1].trim()]||p[1].trim()};`; }
                if(mode==='js') {
                    let j=t.replace(/definir (.+) como (.+)/,'let $1=$2;').replace(/funcao (.+)/,'function $1(){').replace('fim funcao','}').replace(/imprimir (.+)/,'console.log($1);').replace(/mostrar alerta (.+)/,'alert($1);').replace(/se (.+) entao/,'if($1){').replace('senao','}else{').replace('fim se','}').replace(/buscar elemento "([^"]+)" adicionar evento "clique" com (.+)/,'setTimeout(()=>document.querySelector("$1")?.addEventListener("click",$2),500);');
                    if(j.includes(' mais ')) j=j.replace(/ mais /g,' + ');
                    if(j.includes(' menos ')) j=j.replace(/ menos /g,' - ');
                    js+=j+'\n';
                }
            });
            return { full: `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><style>${defCss}${css}</style></head><body>${html}<script>${TERMINAL_SCRIPT}${js}</script></body></html>`, htmlBody: html, css: defCss+css, js };
        };

        const generateAiCode = async (prompt) => {
            const key = window.process.env.API_KEY;
            if(!key) throw new Error("API Key n√£o configurada. V√° em Configura√ß√µes.");
            
            const ai = new GoogleGenAI({ apiKey: key });
            
            const sysPrompt = `Voc√™ converte linguagem natural para c√≥digo 'Chorty'. Regras:
            - Comece com 'criar pagina "Nome"'.
            - Use 'criar corpo' ... 'fechar corpo'.
            - Use 'adicionar titulo "X"', 'adicionar botao "X"', 'adicionar paragrafo "X"'.
            - Estilos: 'criar estilo do corpo', 'cor de fundo: #...', 'cor do texto: ...'.
            - Retorne APENAS o c√≥digo.`;
            
            const result = await ai.models.generateContent({
                model: 'gemini-2.5-flash',
                contents: prompt,
                config: { systemInstruction: sysPrompt }
            });
            
            let text = result.response.text;
            return text.replace(/\`\`\`chorty/g, '').replace(/\`\`\`/g, '').trim();
        };

        // --- 2. COMPONENTES ---

        const Icon = ({name, size=20, className}) => {
            useEffect(()=>{if(window.lucide)window.lucide.createIcons()});
            return <i data-lucide={name} className={className} style={{width:size,height:size,display:'inline-block'}}></i>;
        };

        const LoginScreen = ({ onLogin }) => {
            const [key, setKey] = useState('');
            const [err, setErr] = useState('');
            const check = () => { if(key === CONFIG.MASTER_KEY) { localStorage.setItem('chorty_access', 'true'); onLogin(); } else { setErr('Chave inv√°lida!'); } };
            const openWhatsapp = () => { const text = encodeURIComponent("Ol√°! Gostaria de adquirir uma chave de acesso para o Chorty Studio Ultimate."); window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${text}`, '_blank'); };
            return (
                <div className="h-screen w-screen bg-gray-900 flex flex-col items-center justify-center p-6 text-center animate-in">
                    <div className="w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mb-6 flex items-center justify-center shadow-[0_0_30px_rgba(59,130,246,0.5)]"><span className="text-4xl font-bold text-white">Ch</span></div>
                    <h1 className="text-3xl font-bold text-white mb-2">Chorty Ultimate</h1>
                    <p className="text-gray-400 mb-8 text-sm">Ambiente de Desenvolvimento Mobile</p>
                    <div className="w-full max-w-sm bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <label className="block text-left text-xs font-bold text-gray-500 mb-2 uppercase">Chave de Acesso</label>
                        <input type="password" value={key} onChange={e=>setKey(e.target.value)} className="w-full bg-gray-900 border border-gray-700 rounded-lg p-3 text-white mb-4 focus:border-blue-500 transition-colors" placeholder="Insira sua chave PRO"/>
                        {err && <p className="text-red-400 text-xs mb-4">{err}</p>}
                        <button onClick={check} className="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg mb-4 transition-transform active:scale-95">ENTRAR</button>
                        <button onClick={openWhatsapp} className="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg flex items-center justify-center gap-2 mt-4 transition-transform active:scale-95"><Icon name="message-circle" size={18}/> PEDIR CHAVE NO ZAP</button>
                    </div>
                </div>
            );
        };

        const AboutModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-in">
                <div className="bg-gray-900 w-full max-w-sm rounded-2xl border border-gray-700 p-6 text-center relative shadow-2xl">
                    <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white"><Icon name="x"/></button>
                    <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl mx-auto mb-4 flex items-center justify-center shadow-lg"><span className="font-bold text-2xl text-white">Ch</span></div>
                    <h2 className="text-xl font-bold text-white mb-1">Chorty Ultimate</h2>
                    <p className="text-blue-400 text-xs font-bold mb-6">MOBILE EDITION</p>
                    <div className="bg-gray-800/50 p-4 rounded-xl border border-gray-700 mb-6 text-left">
                        <div className="mb-3">
                            <p className="text-[10px] uppercase font-bold text-gray-500 mb-1">Vers√£o</p>
                            <p className="text-white text-sm">3.0.0 (Stable)</p>
                        </div>
                        <div>
                            <p className="text-[10px] uppercase font-bold text-gray-500 mb-1">Desenvolvedor</p>
                            <div className="flex items-center gap-2">
                                <div className="w-6 h-6 rounded-full bg-gray-700 flex items-center justify-center"><Icon name="user" size={14}/></div>
                                <p className="text-white font-bold text-sm">Adilson C. Rafael</p>
                            </div>
                        </div>
                    </div>
                    <button onClick={onClose} className="w-full py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-white font-bold text-sm transition-colors">Fechar</button>
                </div>
            </div>
        );

        const AiModal = ({ onClose, onApply }) => {
            const [prompt, setPrompt] = useState('');
            const [loading, setLoading] = useState(false);
            const run = async () => {
                setLoading(true);
                try { const code = await generateAiCode(prompt); onApply(code); onClose(); } catch(e) { alert(e.message); }
                setLoading(false);
            };
            return (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
                    <div className="bg-gray-900 w-full max-w-md rounded-2xl border border-gray-700 shadow-2xl overflow-hidden">
                        <div className="p-4 bg-gradient-to-r from-purple-900 to-blue-900 border-b border-white/10 flex justify-between items-center">
                            <h3 className="font-bold text-white flex items-center gap-2"><Icon name="sparkles" className="text-yellow-400"/> Chorty AI</h3>
                            <button onClick={onClose}><Icon name="x" className="text-white/50"/></button>
                        </div>
                        <div className="p-4">
                            <textarea value={prompt} onChange={e=>setPrompt(e.target.value)} placeholder="Ex: Crie uma tela de login preta..." className="w-full h-32 bg-gray-800 rounded-lg p-3 text-white text-sm mb-4 border border-gray-700"/>
                            <button onClick={run} disabled={loading} className="w-full py-3 bg-blue-600 rounded-lg text-white font-bold flex justify-center gap-2">{loading ? 'Pensando...' : <><Icon name="wand-2"/> Gerar C√≥digo</>}</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Editor = ({ code, setCode, theme }) => (
            <textarea value={code} onChange={e=>setCode(e.target.value)} className="w-full h-full bg-transparent text-sm p-4 font-mono outline-none resize-none" style={{color: theme.text}} spellCheck="false"/>
        );

        // --- 3. APLICA√á√ÉO ---
        const App = () => {
            const [locked, setLocked] = useState(true);
            const [code, setCode] = useState(`# Chorty Ultimate Mobile
criar pagina "App Demo"

criar estilo do corpo
cor de fundo: #1a1a1a
cor do texto: branco
exibicao: flexivel
direcao: coluna
alinhar itens: centro
altura: 100vh
fechar estilo

criar corpo
    adicionar titulo "Ol√° Ultimate! üöÄ"
    adicionar paragrafo "Criado com IA e Login."
    adicionar botao "Clique em mim" com id "btn1"
fechar corpo

criar comportamento
funcao ola
    mostrar alerta "Funciona!"
    imprimir "Terminal Ativo: Ol√° do Chorty!"
fim funcao

buscar elemento "#btn1" adicionar evento "clique" com ola`);
            
            const [view, setView] = useState('editor');
            const [showAi, setShowAi] = useState(false);
            const [showAbout, setShowAbout] = useState(false);
            const [result, setResult] = useState('');
            const [themeName, setThemeName] = useState('dracula');

            useEffect(() => { if(localStorage.getItem('chorty_access')) setLocked(false); }, []);

            const run = () => { const res = transpile(code); setResult(res.full); setView('preview'); };
            const exportZip = () => {
                const z = new JSZip();
                const r = transpile(code);
                z.file("index.html", r.full);
                z.generateAsync({type:"blob"}).then(b => { const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = "projeto.zip"; a.click(); });
            };
            const configKey = () => { const k = prompt("Insira sua Gemini API Key:", window.process.env.API_KEY); if(k) { window.process.env.API_KEY = k; localStorage.setItem('GEMINI_API_KEY', k); } };

            const themes = { dracula: {bg:'#0f172a', text:'#f8fafc'}, matrix: {bg:'#000', text:'#0f0'}, light: {bg:'#fff', text:'#000'} };
            const th = themes[themeName];

            if(locked) return <LoginScreen onLogin={() => setLocked(false)} />;

            return (
                <div className="flex flex-col h-screen w-screen overflow-hidden" style={{backgroundColor: th.bg, color: th.text}}>
                    <div className="h-16 border-b border-gray-700/30 flex items-center justify-between px-4 shrink-0 bg-opacity-90 backdrop-blur">
                        <div className="flex items-center gap-2">
                            <span className="font-bold text-xl bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">Chorty</span>
                            <span className="text-[10px] bg-yellow-500 text-black px-1 rounded font-bold">ULTIMATE</span>
                        </div>
                        <div className="flex gap-2">
                             {view === 'editor' ? (
                                <>
                                    <button onClick={()=>setShowAbout(true)} className="p-2 bg-gray-800 rounded-full text-gray-400"><Icon name="info" size={16}/></button>
                                    <button onClick={configKey} className="p-2 bg-gray-800 rounded-full text-gray-400"><Icon name="settings" size={16}/></button>
                                    <button onClick={()=>setShowAi(true)} className="px-3 py-2 bg-purple-600 rounded-lg font-bold text-xs text-white flex items-center gap-1"><Icon name="sparkles" size={14}/> AI</button>
                                    <button onClick={exportZip} className="p-2 bg-gray-800 rounded-full text-white"><Icon name="download" size={18}/></button>
                                </>
                             ) : (
                                <button onClick={()=>setView('editor')} className="px-4 py-2 bg-gray-700 rounded-full font-bold flex gap-2 text-white"><Icon name="arrow-left"/> Voltar</button>
                             )}
                        </div>
                    </div>

                    <div className="flex-grow relative overflow-hidden">
                        {view === 'editor' && <Editor code={code} setCode={setCode} theme={th} />}
                        {view === 'preview' && <iframe srcDoc={result} className="w-full h-full border-none bg-white"/>}
                        {view === 'editor' && <button onClick={run} className="absolute bottom-6 right-6 w-14 h-14 bg-green-600 rounded-full flex items-center justify-center text-white shadow-lg shadow-green-900/50 hover:scale-110 transition-transform active:scale-90 z-20"><Icon name="play" size={24} className="ml-1"/></button>}
                    </div>

                    {showAi && <AiModal onClose={()=>setShowAi(false)} onApply={setCode} />}
                    {showAbout && <AboutModal onClose={()=>setShowAbout(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>